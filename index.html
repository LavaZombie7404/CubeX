<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CubeX - Learn to Solve Puzzles</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header class="header">
        <h1>CubeX</h1>
        <p>Learn to solve Rubik's cube and Pyraminx</p>
    </header>

    <main class="container">
        <!-- Left Panel: 3D Viewer + Diagram -->
        <section class="left-panel">
            <div class="viewer-panel" id="viewer">
                <!-- Three.js canvas will be inserted here -->
            </div>
            <div class="diagram-panel" id="diagram-panel">
                <div class="diagram-header">
                    <h3>Diagram</h3>
                    <div class="view-switcher">
                        <button class="view-btn active" data-view="net">Net</button>
                        <button class="view-btn" data-view="circular">Circular</button>
                    </div>
                </div>
                <div id="cube-diagram"></div>
            </div>
        </section>

        <!-- Right Panel: Controls -->
        <aside class="control-panel">
            <div class="camera-feed" id="camera-feed">
                <video id="camera-video" autoplay playsinline muted></video>
                <canvas id="camera-canvas"></canvas>
                <svg id="camera-overlay" class="camera-overlay"></svg>
                <div class="camera-placeholder" id="camera-placeholder">
                    <p>Camera Feed</p>
                    <small>Click to enable camera</small>
                </div>
                <!-- Capture flow UI -->
                <div class="capture-flow" id="capture-flow">
                    <div class="capture-progress">
                        <span class="face-indicator pending" data-face="front">Front</span>
                        <span class="face-indicator pending" data-face="right">Right</span>
                        <span class="face-indicator pending" data-face="left">Left</span>
                        <span class="face-indicator pending" data-face="bottom">Bottom</span>
                    </div>
                    <div class="capture-instruction" id="capture-instruction"></div>
                </div>
                <!-- Preview overlay -->
                <div class="color-preview" id="color-preview">
                    <svg id="preview-triangles"></svg>
                    <div class="preview-actions">
                        <button class="camera-btn" id="preview-accept">OK</button>
                        <button class="camera-btn" id="preview-retry">RETRY</button>
                    </div>
                </div>
                <div class="camera-controls" id="camera-controls">
                    <button class="camera-btn" id="camera-toggle" title="Toggle Camera">OFF</button>
                    <button class="camera-btn" id="camera-snapshot" title="Capture" disabled>SNAP</button>
                    <button class="camera-btn" id="camera-detect" title="Detect Colors" disabled>DETECT</button>
                    <button class="camera-btn" id="camera-calibrate" title="Calibrate" disabled>CAL</button>
                    <button class="camera-btn" id="camera-capture" title="Capture Pyraminx" disabled>CAPTURE</button>
                </div>
                <div class="camera-status" id="camera-status"></div>
                <div class="camera-error" id="camera-error"></div>
            </div>

            <div class="controls">
                <div id="moves-section">
                    <h3>Moves</h3>
                    <div class="move-buttons" id="pyraminx-moves" style="display: none;">
                        <div class="move-row">
                            <button class="move-btn" data-move="top" data-reverse="false">U</button>
                            <button class="move-btn" data-move="top" data-reverse="true">U'</button>
                        </div>
                        <div class="move-row">
                            <button class="move-btn" data-move="left" data-reverse="false">L</button>
                            <button class="move-btn" data-move="left" data-reverse="true">L'</button>
                            <button class="move-btn" data-move="right" data-reverse="false">R</button>
                            <button class="move-btn" data-move="right" data-reverse="true">R'</button>
                        </div>
                        <div class="move-row">
                            <button class="move-btn" data-move="back" data-reverse="false">B</button>
                            <button class="move-btn" data-move="back" data-reverse="true">B'</button>
                        </div>
                    </div>
                    <div class="move-buttons" id="cube-moves">
                        <div class="move-row">
                            <button class="move-btn cube-btn" data-move="top" data-reverse="false">U</button>
                            <button class="move-btn cube-btn" data-move="top" data-reverse="true">U'</button>
                            <button class="move-btn cube-btn" data-move="bottom" data-reverse="false">D</button>
                            <button class="move-btn cube-btn" data-move="bottom" data-reverse="true">D'</button>
                        </div>
                        <div class="move-row">
                            <button class="move-btn cube-btn" data-move="right" data-reverse="false">R</button>
                            <button class="move-btn cube-btn" data-move="right" data-reverse="true">R'</button>
                            <button class="move-btn cube-btn" data-move="left" data-reverse="false">L</button>
                            <button class="move-btn cube-btn" data-move="left" data-reverse="true">L'</button>
                        </div>
                        <div class="move-row">
                            <button class="move-btn cube-btn" data-move="front" data-reverse="false">F</button>
                            <button class="move-btn cube-btn" data-move="front" data-reverse="true">F'</button>
                            <button class="move-btn cube-btn" data-move="back" data-reverse="false">B</button>
                            <button class="move-btn cube-btn" data-move="back" data-reverse="true">B'</button>
                        </div>
                    </div>
                    <div class="move-buttons" id="cuboid-moves" style="display: none;">
                        <div id="tree-moves">
                            <div class="move-row">
                                <button class="move-btn cuboid-btn" data-move="top">U</button>
                                <button class="move-btn cuboid-btn" data-move="middle">M</button>
                                <button class="move-btn cuboid-btn" data-move="bottom">B</button>
                            </div>
                            <div class="move-row">
                                <button class="move-btn cuboid-btn" data-move="left">V</button>
                                <button class="move-btn cuboid-btn" data-move="right">C</button>
                            </div>
                        </div>
                        <div id="block-moves" style="display: none;">
                            <div class="move-row">
                                <button class="move-btn cuboid-btn" data-move="top">U</button>
                                <button class="move-btn cuboid-btn" data-move="bottom">D</button>
                            </div>
                            <div class="move-row">
                                <button class="move-btn cuboid-btn" data-move="front">F</button>
                                <button class="move-btn cuboid-btn" data-move="back">B</button>
                            </div>
                        </div>
                    </div>
                    <div class="scramble-section">
                        <button class="scramble-btn" id="scramble-btn">Scramble</button>
                    </div>
                </div>

                <h3>Puzzle</h3>
                <select id="puzzle-select">
                    <option value="pyraminx">Pyraminx</option>
                    <option value="cube2">2x2 Cube</option>
                    <option value="cube3" selected>3x3 Cube</option>
                    <option value="cube4">4x4 Cube</option>
                    <option value="cuboid1x2x3">1x2x3 Cuboid</option>
                </select>

                <div id="figure-section" style="display: none;">
                    <h3>Figure</h3>
                    <select id="figure-select">
                        <option value="block" selected>Block</option>
                        <option value="tree">Tree</option>
                    </select>
                </div>

                <h3>Instructions</h3>
                <div class="instructions" id="instructions">
                    <p>Controls:</p>
                    <ul>
                        <li>Mouse drag to rotate view</li>
                        <li>Scroll to zoom</li>
                        <li>Keys: U, L, R, B for moves</li>
                        <li>Shift + key for reverse</li>
                    </ul>
                </div>

                <h3>Hints</h3>
                <div class="hints" id="hints">
                    <p>Hints will appear here as you learn.</p>
                </div>
            </div>
        </aside>
    </main>

    <!-- Calibration Modal -->
    <div class="modal-overlay" id="calibration-modal">
        <div class="modal-content">
            <h3>Color Calibration</h3>
            <p class="modal-desc">Select a color, point camera at that surface, click SAMPLE</p>
            <div class="calibration-colors" id="cal-colors"></div>
            <div class="calibration-sample" id="cal-sample-area">
                <div class="sample-crosshair"></div>
            </div>
            <div class="modal-actions">
                <button class="camera-btn" id="cal-sample">SAMPLE</button>
                <button class="camera-btn" id="cal-reset">RESET</button>
                <button class="camera-btn" id="cal-close">CLOSE</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="js/pyraminx.js"></script>
    <script src="js/cube.js"></script>
    <script src="js/diagram.js"></script>
    <script src="js/scene.js"></script>
    <script src="js/camera.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
